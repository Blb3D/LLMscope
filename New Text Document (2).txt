@echo off
title ğŸ”­ LLMscope Phase 5 Daily Sync
color 0A
echo.
echo ================================================
echo   LLMscope Phase 5 - Daily Verification & Push
echo ================================================
echo.

REM ---- Step 1: Set working directory ----
cd /d "%~dp0"
if errorlevel 1 (
    echo âŒ Failed to change directory. Exiting.
    pause
    exit /b
)

REM ---- Step 2: Run repo verification ----
echo ğŸ§  Checking Git repository integrity...
python scripts\git_verify_phase5.py
if errorlevel 1 (
    echo âš ï¸  Git verification reported an issue.
    pause
)

REM ---- Step 3: Optional Docker verification ----
if exist scripts\docker_verify_build.py (
    echo ğŸ§© Running Docker build verification...
    python scripts\docker_verify_build.py
)

REM ---- Step 4: Stage and commit changes ----
echo ğŸ“¦ Staging any updated files...
git add .
git reset .env 2>nul
git reset **/.env 2>nul

set /p COMMSG=Enter commit message (default: "Daily Phase 5 sync"): 
if "%COMMSG%"=="" set COMMSG=Daily Phase 5 sync

git commit -m "%COMMSG%"
if errorlevel 1 (
    echo âš ï¸  Nothing to commit or commit failed.
) else (
    echo âœ… Commit complete.
)

REM ---- Step 5: Pull & Push to GitHub ----
echo ğŸ”„ Pulling latest remote updates...
git pull origin main --allow-unrelated-histories --no-rebase

echo ğŸš€ Pushing to GitHub...
git push origin main

REM ---- Step 6: Tag the commit ----
for /f "tokens=2 delims==" %%v in ('wmic os get localdatetime /value ^| find "="') do set datetime=%%v
set tagdate=%datetime:~0,8%
git tag -a v0.5-phase5-%tagdate% -m "Daily sync on %tagdate%"
git push origin --tags

echo.
echo âœ… Daily sync complete!
pause
