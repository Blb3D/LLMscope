# ---- build stage ----
FROM node:22-alpine AS builder
WORKDIR /app

# Copy package metadata and install deps
COPY frontend/package*.json ./
RUN npm install --no-audit --no-fund

# Copy the rest of the source and build
COPY frontend/ .
RUN npm run build

# ---- production stage ----
FROM nginx:1.27-alpine
WORKDIR /usr/share/nginx/html

# Copy compiled assets from the builder stage
COPY --from=builder /app/dist/ ./

# Copy Nginx configuration
COPY nginx.conf /etc/nginx/conf.d/default.conf

# Expose standard web port
EXPOSE 80

# Optional health check (can keep if you like)
HEALTHCHECK CMD curl -f http://localhost:80/health || exit 1  CMD wget -qO- http://localhost:80/ >/dev/null || exit 1

CMD ["nginx", "-g", "daemon off;"]
